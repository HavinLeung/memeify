#!/usr/bin/env python3
import cmd, sys, subprocess
import random

def spongebob(text:str):
    """
    SpOnGeboB mOCkiNg mEMe
    transform text to have random uppercase and lowercase characters
    """
    if not text:
        return text
    prob = 0.5
    prev_was_upper = None
    def update_prob(is_upper:bool):
        """
        exponential backoff inspired randomization
        """
        nonlocal prev_was_upper, prob
        base_prob = 0.5
        # k should be >= 1. 
        # set it higher for a lower chance of multiple lower/upper cases in a row
        k = 2.0
        if prev_was_upper is None:
            # abusing python's type system is hilarious
            prev_was_upper = is_upper
            return

        if prev_was_upper and is_upper:
            prob = 1 - prob**k
        elif not prev_was_upper and is_upper:
            prob = 1 - base_prob**k
        elif prev_was_upper and not is_upper:
            prob = base_prob**k
        else:
            prob = prob**k
        prev_was_upper = is_upper

    def choose(up, low):
        r = random.random()
        if r >= prob:
            update_prob(True)
            return up
        else:
            update_prob(False)
            return low
    def randomize(char:str):
        assert(len(char) == 1)
        if char.isalpha():
            return choose(char.upper(), char.lower())
        return char
    return ''.join(map(randomize, text))

def copy_to_clipboard_macos_only(text:str):
    # from https://stackoverflow.com/a/17371323
    subprocess.run('pbcopy', universal_newlines=True, input=text)
    print('copied to clipboard!')

copypastas = {
    "navy_seal_clean" : "What the jiminy crickets did you just flaming say about me, you little bozo? Iâ€™ll have you know I graduated top of my class in the Cub Scouts, and Iâ€™ve been involved in numerous secret camping trips in Wyoming, and I have over 300 confirmed knots. I am trained in first aid and Iâ€™m the top bandager in the entire US Boy Scouts (of America). You are nothing to me but just another friendly face. I will clean your wounds for you with precision the likes of which has never been seen before on this annual trip, mark my words. You think you can get away with saying those shenanigans to me over the Internet? Think again, finkle. As we speak I am contacting my secret network of MSN friends across the USA and your IP is being traced right now so you better prepare for the seminars, man. The storm that wipes out the pathetic little thing you call your bake sale. Youâ€™re frigging done, kid. I can be anywhere, anytime, and I can tie knots in over seven hundred ways, and thatâ€™s just with my bare hands. Not only am I extensively trained in road safety, but I have access to the entire manual of the United States Boy Scouts (of America) and I will use it to its full extent to train your miserable butt on the facts of the continents, you little schmuck. If only you could have known what unholy retribution your little â€œcleverâ€ comment was about to bring down upon you, maybe you would have held your silly tongue. But you couldnâ€™t, you didnâ€™t, and now youâ€™re paying the price, you goshdarned sillyhead. I will throw leaves all over you and you will dance in them. Youâ€™re friggin done, kiddo.",
    "darth_plagueis" : "Did you ever hear the tragedy of Darth Plagueis The Wise? I thought not. Itâ€™s not a story the Jedi would tell you. Itâ€™s a Sith legend. Darth Plagueis was a Dark Lord of the Sith, so powerful and so wise he could use the Force to influence the midichlorians to create lifeâ€¦ He had such a knowledge of the dark side that he could even keep the ones he cared about from dying. The dark side of the Force is a pathway to many abilities some consider to be unnatural. He became so powerfulâ€¦ the only thing he was afraid of was losing his power, which eventually, of course, he did. Unfortunately, he taught his apprentice everything he knew, then his apprentice killed him in his sleep. Ironic. He could save others from death, but not himself.",
    "good_shit" : "ðŸ‘ŒðŸ‘€ðŸ‘ŒðŸ‘€ðŸ‘ŒðŸ‘€ðŸ‘ŒðŸ‘€ðŸ‘ŒðŸ‘€ good shit goà±¦Ô sHitðŸ‘Œ thats âœ” some goodðŸ‘ŒðŸ‘Œshit rightðŸ‘ŒðŸ‘Œth ðŸ‘Œ ereðŸ‘ŒðŸ‘ŒðŸ‘Œ rightâœ”there âœ”âœ”if i do Æ½aÒ¯ so my selï½† ðŸ’¯ i say so ðŸ’¯ thats what im talking about right there right there (chorus: Ê³á¶¦áµÊ°áµ— áµ—Ê°áµ‰Ê³áµ‰) mMMMMáŽ·ÐœðŸ’¯ ðŸ‘ŒðŸ‘Œ ðŸ‘ŒÐO0Ðžà¬ ï¼¯OOï¼¯OÐžà¬ à¬ Ooooáµ’áµ’áµ’áµ’áµ’áµ’áµ’áµ’áµ’ðŸ‘Œ ðŸ‘ŒðŸ‘Œ ðŸ‘Œ ðŸ’¯ ðŸ‘Œ ðŸ‘€ ðŸ‘€ ðŸ‘€ ðŸ‘ŒðŸ‘ŒGood shit",
    "uno_reverse_ascii" : 
'''â â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ‚
â „â „â£°â£¾â£¿â£¿â£¿â ¿â ¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£†â „â „
â „â „â£¿â£¿â£¿â¡¿â ‹â „â¡€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ¿â ›â ‹â£‰â£‰â£‰â¡‰â ™â »â£¿â£¿â „â „
â „â „â£¿â£¿â£¿â£‡â ”â ˆâ£¿â£¿â£¿â£¿â£¿â¡¿â ›â¢‰â£¤â£¶â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¦â¡€â ¹â „â „
â „â „â£¿â£¿â ƒâ „â¢ â£¾â£¿â£¿â£¿â Ÿâ¢â£ â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â „â „
â „â „â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ¢â£´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â „â „
â „â „â£¿â£¿â£¿â£¿â£¿â¡Ÿâ â£´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â „â „
â „â „â£¿â£¿â£¿â£¿â ‹â¢ â£¾â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ¿â ¿â ¿â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â „â „
â „â „â£¿â£¿â¡¿â â£°â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â —â „â „â „â „â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡Ÿâ „â „
â „â „â£¿â¡¿â â£¼â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ‹â „â „â „â£ â£„â¢°â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ƒâ „â „
â „â „â¡¿â â£¼â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡‡â „â¢€â¡´â šâ¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡â¢ â „â „
â „â „â ƒâ¢°â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â£¿â£¿â ´â ‹â „â „â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡Ÿâ¢€â£¾â „â „
â „â „â¢€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ƒâ ˆâ â „â „â¢€â£´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡Ÿâ¢€â£¾â£¿â „â „
â „â „â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â „â „â „â „â¢¶â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â â¢€â£¾â£¿â£¿â „â „
â „â „â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£¶â£¶â£¶â£¶â£¶â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ‹â£ â£¿â£¿â£¿â£¿â „â „
â „â „â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ¢â£¼â£¿â£¿â£¿â£¿â£¿â „â „
â „â „â¢»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ¢â£´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â „â „
â „â „â ˆâ¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â Ÿâ¢â£´â£¿â£¿â£¿â£¿â —â „â „â£¿â£¿â „â „
â „â „â£†â ˆâ »â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â ¿â ›â£‰â£¤â£¾â£¿â£¿â£¿â£¿â£¿â£‡â  â ºâ£·â£¿â£¿â „â „
â „â „â£¿â£¿â£¦â£„â£ˆâ£‰â£‰â£‰â£¡â£¤â£¶â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ‰â â£€â£¼â£¿â£¿â£¿â „â „
â „â „â »â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£¶â£¾â£¿â£¿â¡¿â Ÿâ „â „
â  â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „''',
    "saitama_ok_ascii" : 
'''â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â£ â£¶â¡¾â â ‰â ™â ³â¢¦â¡€â €â €â €â¢ â žâ ‰â ™â ²â¡€â €
â €â €â €â£´â ¿â â €â €â €â €â €â €â¢³â¡€â €â¡â €â €â €â €â €â¢·
â €â €â¢ â£Ÿâ£‹â¡€â¢€â£€â£€â¡€â €â£€â¡€â£§â €â¢¸â €â €â €â €â € â¡‡
â €â €â¢¸â£¯â¡­â â ¸â£›â£Ÿâ †â¡´â£»â¡²â£¿â €â£¸â €â €OKâ € â¡‡
â €â €â£Ÿâ£¿â¡­â €â €â €â €â €â¢±â €â €â£¿â €â¢¹â €â €â €â €â € â¡‡
â €â €â ™â¢¿â£¯â „â €â €â €â¢€â¡€â €â €â¡¿â €â €â¡‡â €â €â €â €â¡¼
â €â €â €â €â ¹â£¶â †â €â €â €â €â €â¡´â ƒâ €â €â ˜â ¤â£„â£ â žâ €
â €â €â €â €â €â¢¸â£·â¡¦â¢¤â¡¤â¢¤â£žâ£â €â €â €â €â €â €â €â €â €â €
â €â €â¢€â£¤â£´â£¿â£â â €â €â ¸â£â¢¯â£·â£–â£¦â¡€â €â €â €â €â €â €
â¢€â£¾â£½â£¿â£¿â£¿â£¿â ›â¢²â£¶â£¾â¢‰â¡·â£¿â£¿â µâ£¿â €â €â €â €â €â €
â£¼â£¿â â ‰â£¿â¡­â ‰â ™â¢ºâ£‡â£¼â¡â €â €â €â£„â¢¸â €â €â €â €â €â €
â£¿â£¿â£§â£€â£¿.........â£€â£°â£â£˜â£†â£€â €â €''',
}

class Meme(cmd.Cmd):
    intro = 'use `help` if you are confused'
    prompt = '(meme) > '
    def do_spongebob(self, arg):
        'turn text input into SpOnGeboB mOCkiNg mEMe'
        if not arg:
            print('invalid usage!')
            return
        t = spongebob(arg)
        print(t)
        copy_to_clipboard_macos_only(t)

    def do_copypasta(self, arg):
        'copy a common copypasta to your clipboard'
        if not arg in copypastas:
            print('copypasta \"{}\" not recognized'.format(arg))
            return False
        t = copypastas[arg]
        print(t)
        copy_to_clipboard_macos_only(t)
    
    def complete_copypasta(self, text, line, begidx, endidx):
        if not text:
            return list(copypastas.keys())
        return list(filter(lambda x: x.startswith(text), copypastas.keys()))

    def do_exit(self, arg):
        'quits session'
        return True
    def do_quit(self, arg):
        'quits session'
        return True

if __name__ == '__main__':
    app = Meme()
    if len(sys.argv) > 1:
        app.onecmd(' '.join(sys.argv[1::]))
    else:
        app.cmdloop()

